\documentclass[11pt]{article}

\usepackage[margin = 1in]{geometry}
\usepackage{graphicx}              
\usepackage{amsmath}               
\usepackage{amsfonts}              
\usepackage{amsthm}                
\usepackage{amssymb}
\usepackage{mathrsfs}
\usepackage{url}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{algpseudocode}
\usepackage[plain]{algorithm}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage{authblk}
\usepackage{tcolorbox}
\usepackage{mathtools}
\usepackage{bm}
\usepackage{dsfont}
\usepackage{tikz}
\usepackage{quantikz}
%\usepackage[T1]{fontenc}
%\usepackage{libertine}
%\usepackage[libertine]{newtxmath}


\hypersetup{
	unicode = true,
	colorlinks = true,
	citecolor = blue,
	filecolor = blue,
	linkcolor = blue,
	urlcolor = blue,
	pdfstartview = {FitH},
}

% theorem environments
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{example}[theorem]{Example}
\newtheorem*{remark}{Remark}
\newtheorem{note}{Note}
\newtheorem*{problem}{Problem}
\newtheorem*{fact}{Fact}



\algrenewcommand{\Require}{\item[\textbf{Input:}]}
\algrenewcommand{\Ensure}{\item[\textbf{Output:}]}

\newcommand{\wrt}{\vdash} 
\newcommand{\tildO}{\tilde{O}}

% roman numerals
\newcommand{\romnum}[1]{\romannumeral #1}
\newcommand{\Romnum}[1]{\uppercase\expandafter{\romannumeral #1}}

\newcommand{\todo}[1]{\textcolor{red}{TODO: #1}}

\DeclareMathOperator{\fieldchar}{char} % characteristic of a field
\DeclareMathOperator{\groupofend}{End} % endomorphism ring
\DeclareMathOperator{\tr}{Tr} % finite field trace
\DeclareMathOperator{\gal}{Gal} % Galois group
\DeclareMathOperator{\order}{ord} % order of an element
\DeclareMathOperator{\lcm}{lcm} % least common multiple
\DeclareMathOperator{\divisor}{div} % divisor on a curve
\DeclareMathOperator{\supp}{supp} % support of a divisor
\DeclareMathOperator{\norm}{N} % norm
\DeclareMathOperator{\negl}{negl} % norm
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\minpoly}{minpoly}
\DeclareMathOperator{\loglog}{loglog}
\DeclareMathOperator{\polylog}{polylog}
\DeclareMathOperator{\poly}{poly}
\DeclareMathOperator{\rev}{rev}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\qft}{F}
\DeclareMathOperator{\E}{\mathbb{E}}


\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\let\ket\relax
\DeclarePairedDelimiter{\ket}{\lvert}{\rangle}
\let\bra\relax
\DeclarePairedDelimiter{\bra}{\langle}{\rvert}
\DeclarePairedDelimiter{\lrang}{\langle}{\rangle}
\DeclarePairedDelimiter{\opnorm}{\lVert}{\rVert}


\def\Q{\mathbb{Q}}
\def\C{\mathbb{C}}
\def\K{\mathbb{K}}
\def\N{\mathbb{N}}
\def\R{\mathbb{R}}
\def\Z{\mathbb{Z}}
\def\F{\mathbb{F}}
\def\P{\mathbb{P}}
\def\MM{\mathsf{M}}
\def\CC{\mathsf{C}}
\def\lwe{\mathsf{LWE}}
\def\edcp{\mathsf{EDCP}}
\def\gen{\mathsf{Gen}}
\def\enc{\mathsf{Enc}}
\def\dec{\mathsf{Dec}}


\title{Quantum Learning With Errors}

\author{
	%% Javad Oilskin\thanks{Department of Computer Science, Ryerson University,
	%% (\tt{javad.doliskani@ryerson.ca}).}
}

\date{}
\setlength{\parindent}{0pt}
\sloppy




\begin{document}
\maketitle





%% ///////////////////////////////////////////////////////



\section{Preliminaries}
\label{sec:preli}

In this section, we review some basic concepts and notations of quantum computing and the learning with error (LWE) problem. 

Let $n \ge 1$, and $q \ge 2$ be integers, and let $\chi$ be a probability distribution over $\Z$. For a random fixed $\bm{s} \in \Z_q^n$, denote by $A_{\bm{s}, \chi}$ the probability distribution over $\Z_q^n \times \Z_q$ defined as follows: choose $\bm{a} \in \Z_q^n$ uniformly at random, choose $e$ from according to $\chi$ and output  $(\bm{a}, \lrang{\bm{a}, \bm{s}} + e)$.
\begin{definition}[LWE, Search]
The search-$\lwe_{n, q, \chi}$ is the problem of recovering $\bm{s}$ given samples from the distribution $A_{\bm{s}, \chi}$. An algorithm $Q$ is said to solve $\lwe_{n, q, \chi}$ if $Q$  outputs $\bm{s}$ with probability at least $1 / \poly(n\log q)$ and has running time at most $\poly(n \log q)$.
\end{definition}
\begin{definition}[LWE, Decision]
    The decision-$\lwe_{n, q, \chi}$ problem is to distinguish between the distribution $A_{\bm{s}, \chi}$ and the uniform distribution over $\Z_q^n \times \Z_q$. An algorithm $Q$ is said to solve the desicion-$\lwe_{n, q, \chi}$ if it succeeds with advantage at least $1 / \poly(n\log q)$ and has running time at most $\poly(n\log q)$. 
\end{definition}
Let $n \ge 1$ and $q \ge 2$ be as above and let $r < q$ be a positive integer. Let $\Sigma = \Z_r \times \Z_q^n$ and define the complex Euclidean space $\mathcal{X} = \C^\Sigma$. For a fixed $\bm{s} \in \Z_q^n$ define the probability distribution $B_{\bm{s}, r}$ over a finite subset of $\mathcal{X}$ as follows: choose $\bm{x} \in \Z_q^n$ uniformly at random and output the state
\[ \ket{\phi_{\bm{s}, r}(\bm{x})} = \frac{1}{\sqrt{r}} \sum_{j = 0}^{r - 1}\ket{j}\ket{\bm{x} + j\bm{s}}. \]
Since $\bm{s}$ is fixed and $\bm{x}$ is uniformly random and unknown, the quantum system corresponding to the state $\ket{\phi_{\bm{s}, r}(\bm{x})}$ is described by the density operator
\[ \rho_{\bm{s}, r} = \frac{1}{q^n} \sum_{\bm{x} \in \Z_q^n} \ket{\phi_{\bm{s}, r}(\bm{x})} \bra{\phi_{\bm{s}, r}(\bm{x})}. \]
Therefore, the output of the distribution $B_{\bm{s}, r}$ is always described the density operator $\rho_{\bm{s}, r}$. In other words, the distribution $B_{\bm{s}, r}$ provides \textit{copies} of the state $\rho_{\bm{s}, r}$.
\begin{definition}[EDCP, Search]
    Let $n$, $q$ and $r$ be defined as above. The search-$\edcp_{n, q, r}$ is the problem of recovering $\bm{s}$ given samples from the distribution $B_{\bm{s}, r}$. A quantum algorithm $Q$ is said to solve $\edcp_{n, q, r}$ if it outputs $\bm{s}$ with probability at least $1 / \poly(n\log q)$ and has running time at most $\poly(n\log q)$.
\end{definition}
\begin{definition}[\cite{watrous2009zero}]
    Let $A, B$ be probability distributions on a finite subset of a complex Euclidean space $\mathcal{X}$. Then $A$ is said to be $(s, \epsilon)$-distinguishable from $B$ if there is a quantum measurement circuit $Q$ of size $s$ such that
    \[ \abs*{ \Pr_{\rho \in A}[Q(\rho) = 1] - \Pr_{\rho \in B}[Q(\rho) = 1] } \ge \epsilon. \]
\end{definition} 
Two distributions $A, B$ are $(s, \epsilon)$-indistinguishable if they are not $(s, \epsilon)$-distinguishable.
\begin{definition}
    For each $n \in \N$, let $A_n$ and $B_n$ be probability distributions on a finite subset of a complex Euclidean space $\mathcal{X}_n$. Then the two ensembles $\{ A_n \}_{n \in \N}$ and $\{ B_n \}_{n \in \N}$ are said to be polynomially quantum indistinguishable if for all polynomially bounded functions $s, p: \N \rightarrow \N$, the distributions $A_n$ and $B_n$ are $(s(n), 1 / p(n))$-indistinguishable for almost all $n \in \N$.
\end{definition}
Two ensembles are called quantum computationally indistinguishable if they are polynomially quantum indistinguishable. The advantage of a polynomial-time quantum algorithm $Q$ in distinguishing between the distributions $A_n$ and $B_n$ is defined as
\[ \delta_Q(A_n, B_n) = \abs*{ \Pr_{\rho \in A_n}[Q(\rho) = 1] - \Pr_{\rho \in B_n}[Q(\rho) = 1] }. \]
Two ensembles $\{ A_n \}_{n \in \N}$ and $\{ B_n \}_{n \in \N}$ are then quantum computationally indistinguishable if $\delta_Q(A_n, B_n) = \negl(n)$ for all such $Q$ and almost all $n$. 
\begin{definition}[EDCP, Decision]
    \label{def:d-edcp}
    Let $n$, $q$ and $r$ be defined as above. Define the probability distribution $U_{r}$ over a finite subset of $\mathcal{X}$ by choosing $(j, \bm{x}) \in \Z_r \times \Z_q^n$ uniformly at random and outputting the state $\ket{j}\ket{\bm{x}}$. The decision-$\edcp_{n, q, r}$ is the problem of distinguishing between the distributions $B_{\bm{s}, r}$ and $U_r$.
\end{definition}
A quantum algorithm $Q$ is said to solve the decision-$\edcp_{n, q, r}$ if it succeeds with advantage at least $1 / \poly(n\log q)$ and has running time at most $\poly(n\log q)$. The density operator corresponding to the output of the distribution $U_r$ in Definition \ref{def:d-edcp} is
\[ \rho = \frac{1}{rq^n} \sum_{j = 0}^{r - 1} \sum_{\bm{x} \in \Z_q^n}  \ket{j}\ket{\bm{x}} \bra{j}\bra{\bm{x}} = \mathds{1}_{\mathcal{X}}. \]
Therefore, decision-$\edcp_{n, q, r}$ is the problem of distinguishing between the same number of copies of the states $\rho_{\bm{s}, r}$ and $\mathds{1}_{\mathcal{X}}$. 


%% ///////////////////////////////////////////////////////



\section{Search to Decision Reduction}

In this section, we give a search-to-decision reduction for $\edcp$. The reduction works for a large class of moduli $q$. The technique we use is inspired by the one used in \cite{micciancio2012trapdoors} for a search-to-decision reduction for LWE.
\begin{lemma}
    \label{lem:small-r}
    For any $r' \le r$, given access to the distribution $B_{\bm{s}, r}$, we can efficiently sample from the distribution $B_{\bm{s}, r'}$. 
\end{lemma}
\begin{proof}
    If $r' > r / 2$ then a simple indicator function can be used to to produce sample from $B_{\bm{s}, r'}$. More precisely, define the function $f: [0, r) \rightarrow \{ 0, 1 \}$ by
    \[ f(x) = 
    \begin{cases}
        1 & \text{if } x < r' \\
        0 & \text{otherwise}.
    \end{cases} \]
    Then applying the transformation $\ket{j}\ket{\bm{a}}\ket{0} \mapsto \ket{j}\ket{\bm{a}}\ket{f(j)}$, where $\bm{a} \in \Z_q^n$, to $\rho_{\bm{s}, r}$ and measuring the last register results in the state $\rho_{\bm{s}, r'}$ with probability at least $1 / 2$. If the measurement outcome is not $1$ then we repeat the above process.

    If $r' \le r / 2$ then we proceed as follows. Consider the measurement $\mu$ on the space $\mathcal{X}$ defined by the operators
    \[ M_a = \sum_{b = 0}^{\ell - 1} \ket{b}\bra{ar' + b} \otimes \mathds{1}, \]
    where $\ell = r'$ for $0 \le a < \lfloor r / r'  \rfloor$ and $\ell = r - r'$ for $a = \lfloor r / r'  \rfloor$. This measurement can be implemented efficiently \cite{kaye2007introduction}. If we perform $\mu$ on a sample $\rho_{\bm{s}, r}$ from $B_{\bm{s}, r}$ the probability of observing the outcome $a$ is
    \begin{align*}
        \tr(M_a^*M_a \rho_{\bm{s}, r})
        & = \frac{1}{q^n} \sum_{\bm{x} \in \Z_q^n} \tr(M_a \ket{\phi_{\bm{s}, r}(\bm{x})} \bra{\phi_{\bm{s}, r}(\bm{x})} M_a^*) \\
        & = \frac{1}{q^nr} \sum_{\bm{x} \in \Z_q^n} \sum_{b, c = 0}^{\ell - 1} \tr(\ket{b}\ket{\bm{x} + (ar' + b)\bm{s}} \bra{c}\bra{\bm{x} + (ar' + c)\bm{s}}) \\
        & = \frac{1}{q^nr} \sum_{\bm{x} \in \Z_q^n} \sum_{b, c = 0}^{\ell - 1} \tr(\ket{b}\bra{c} \otimes \ket{\bm{x} + (ar' + b)\bm{s}} \bra{\bm{x} + (ar' + c)\bm{s}}) \\
        & = \frac{\ell}{r},
    \end{align*}
    and the post-measurement state corresponding to this outcome is
    \begin{align*}
        \frac{M_a \rho_{\bm{s}, r} M_a^*}{(\ell / r)}
        & = \frac{1}{q^nr} \sum_{\bm{x} \in \Z_q^n} \sum_{b, c = 0}^{\ell - 1} \ket{b}\ket{\bm{x} + (ar' + b)\bm{s}} \bra{c}\bra{\bm{x} + (ar' + c)\bm{s}} \\
        & = \frac{1}{q^nr} \sum_{\bm{x} \in \Z_q^n} \sum_{b, c = 0}^{\ell - 1} \ket{b}\ket{\bm{x} + b\bm{s}} \bra{c}\bra{\bm{x} + c\bm{s}} \\
        & = \rho_{\bm{s}, \ell},
    \end{align*}
    So if the outcome is $a \in [0, \lfloor r / r'  \rfloor)$ we obtain the state $\rho_{\bm{s}, r'}$, which is what we are looking for. Therefore, the probability of obtaining the desired state after one measurement is
    \[ \lfloor r / r' \rfloor \frac{\ell}{r} = \lfloor r / r' \rfloor \frac{r'}{r} \ge \left( \frac{r}{r'} - 1 \right)\frac{r}{r'} = 1 - \frac{r'}{r} \ge \frac{1}{2}. \]
    If the measurement outcome is $a = \lfloor r / r' \rfloor$ then we repeat the above process.
\end{proof}
\begin{theorem}
    Let $q = p_1^{e_1} \cdots p_\ell^{e_\ell}$ be the prime factorization of $q$ and assume that the primes $p_i$ are of size $\poly(n)$. Then there is a polynomial-time quantum reduction from solving search-$\edcp_{n, q, r}$ to solving decision-$\edcp_{n, q, r'}$ for any $r' \le r$ such that $r' \le p_i^{e_i}$ for all $i$. 
\end{theorem}
\begin{proof}
    Let $D$ be an oracle for solving decision-$\edcp_{n, q, r'}$. Given samples from the distribution $B_{\bm{s}, r}$, we will use $D$ to recover $\bm{s} \bmod p^{e_i}$ for each $i$, and then assemble the results using the Chinese remainder theorem to recover $\bm{s} \bmod q$. We shall compute $\bm{s} \bmod p_1^{e_1}$, the algorithm is the same for the other $p_i$. Let $p = p_1$ and $e = e_1$.

    The first step is to construct the distribution $B_{\bm{s}, r'}$ from the distribution $B_{\bm{s}, r}$. This can be efficiently done using Lemma \ref{lem:small-r}. Now, from $B_{\bm{s}, r'}$ we construct the distribution $B_{\bm{s}, r'}^k$ for all $k = 1, \dots, e$. Given a sample $\rho_{\bm{s}, r'}$ from $B_{\bm{s}, r'}$, a sample from $B_{\bm{s}, r'}^k$ is constructed by computing $j \bmod p^k$ into an auxiliary register and then discarding the register. More precisely, if we denote by  $\ket{\phi_{\bm{s}, r'}^k(\bm{x})}$ the result of 
    \begin{align}
        \ket{\phi_{\bm{s}, r'}(\bm{x})}\ket{0}
        & \mapsto \frac{1}{\sqrt{r'}} \sum_{j = 0}^{r' - 1} \ket{j}\ket{\bm{x} + j\bm{s}}\ket{j \bmod p^k} \label{equ:r-1}  \\
        & \mapsto \frac{1}{\sqrt{r_k}} \sum_{j = 0}^{r_k - 1} \ket{jp^k + c}\ket{\bm{x} + (jp^k + c)\bm{s}}, \nonumber
    \end{align}
    where $0 \le r_k \le \lfloor r' / p^k \rfloor$ and the random constant $0 \le c \le p^k - 1$ depend on the outcome of measuring the last register, then
    \[ \rho_{\bm{s}, r'}^k = \frac{1}{q^n} \sum_{\bm{x} \in \Z_q^n} \ket{\phi_{\bm{s}, r'}^k(\bm{x})} \bra{\phi_{\bm{s}, r'}^k(\bm{x})} \]
    is a sample from $B_{\bm{s}, r'}^k$. For $k = 0$ we have $j = 0 \bmod p^0$ for all $j$, so $\rho_{\bm{s}, r'}^0 = \rho_{\bm{s}, r'}$ and the distribution $B_{\bm{s}, r'}^0$ is the same as $B_{\bm{s}, r'}$. For $k = e$, since $r' \le p^e$, discarding the last register in \eqref{equ:r-1} collapses the state $\rho_{\bm{s}, r'}$ to $\mathds{1}$. Therefore, by a hybrid argument there is a $1 \le k \le e$ such that $\edcp_{n, q, r'}$ can distinguish between $B_{\bm{s}, r'}^{k - 1}$ and $B_{\bm{s}, r'}^k$ with non-negligible advantage. Using the amplification technique of Section ?? we can assume that the distinguishing advantage is exponentially close to $1$. Let $\bm{s} = (s_1, \dots, s_n)$. Given samples from $B_{\bm{s}, r'}^{k - 1}$ we can compute $s_1 \bmod p$ as follows. Consider the state $\ket{\phi_{\bm{s}, r'}^{k - 1}(\bm{x})}$ where $\bm{x} = (x_1, \dots, x_n)$, and let $y \in \Z_p$. If we perform the transformation $\ket{j}\ket{\bm{a}}\ket{0} \mapsto \ket{j}\ket{\bm{a}}\ket{a_1 - jy \bmod p^k}$ on $\ket{\phi_{\bm{s}, r'}^{k - 1}(\bm{x})}$ we have
    \[ \ket{\phi_{\bm{s}, r'}^{k - 1}(\bm{x})}\ket{0} \mapsto \frac{1}{\sqrt{r_{k - 1}}} \sum_{j = 0}^{r_{k - 1} - 1} \ket{jp^{k - 1} + c}\ket{\bm{x} + (jp^{k - 1} + c)\bm{s}}\ket{x_1 + (jp^{k - 1} + c)(s_1 - y) \bmod p^k}. \]
    If we measure the last register, the resulting state will be a sample from $B_{\bm{s}, r'}^{k - 1}$ or $B_{\bm{s}, r'}^k$ depending on whether $s_1 = y$ or $s_1 \ne y \bmod p$:
    \begin{itemize}
    \item $y = s_1 \bmod p$. In this case, the value of the last register is $x_1 \bmod p$ which is not entangled with the first two registers. So we obtain the original sample from $B_{\bm{s}, r'}^{k - 1}$.
    \item $y \ne s_1 \bmod p$. In this case, the new state contains the terms with $j = (c_1 - x_1) / (s_1 - y) - c \bmod p$ for a random constant $0 \le c_1 \le p^k - 1$. So the new state is
    \begin{align*}
        \ket{\psi}
        & = \frac{1}{\sqrt{r_k}} \sum_{j = 0}^{r_k - 1} \ket{(jp + c_2)p^{k - 1} + c}\ket{\bm{x} + ((jp + c_2)p^{k - 1} + c)\bm{s}} \\
        & = \frac{1}{\sqrt{r_k}} \sum_{j = 0}^{r_k - 1} \ket{jp^k + c_2p^{k - 1} + c}\ket{\bm{x} + (jp^k + c_2p^{k - 1} + c)\bm{s}}
    \end{align*}
    where $0 \le c_2 \le p - 1$ is a random constant and $0 \le r_k \le \lfloor r_{k - 1} / p \rfloor$. The mixed state corresponding to $\ket{\psi}$ is clearly a sample from $B_{\bm{s}, r'}^k$.
    \end{itemize}
    Therefore, using $D$ we can find out whether $y = s_1 \bmod p$. By trying every $y \in \Z_p$ we can recover $s_1 \bmod p$. Assume we have recovered the first $h$ digits of $s_1$ in base $p$, that is we have computed $0 \le \tilde{s}_1 < p^h$ such that $\tilde{s}_1 = s_1 \bmod p^h$. To compute the $(h + 1)$-th digit, we perform the transformation
    \[ \ket{j}\ket{\bm{a}}\ket{0} \mapsto \ket{j}\ket{\bm{a}}\ket{(a_1 - j\tilde{s}_1) / p^h - jy \bmod p}  \]
    on the samples from $B_{\bm{s}, r'}^{k - 1}$ and repeat the above procedure.
\end{proof}
\begin{corollary}
    Let $q = p_1^{e_1} \cdots p_\ell^{e_\ell}$ be the prime factorization of $q$ and assume that the primes $p_i$ are of size $\poly(n)$. If $r \le p_i^{e_i}$ for all $1 \le i \le \ell$ then there is a polynomial-time quantum reduction from solving search-$\edcp_{n, q, r}$ to solving decision-$\edcp_{n, q, r}$. In particular, if $q$ is a prime power then search-$\edcp_{n, q, r}$ and decision-$\edcp_{n, q, r}$ are quantum polynomial-time equivalent.
\end{corollary}
It follows from the above corollary that for the two special cases $q = 2^e$ and $q = p$, where $p$ is $\poly(n)$-bounded prime, the search-$\edcp$ and decision-$\edcp$ are polynomial-time equivalent without loss of parameters. 



%% ///////////////////////////////////////////////////////



\section{A Better Decision Problem}

In this section, we propose an $\edcp$ decision problem that will be more suitable for applications than the one defined in Section \ref{sec:preli}. We assume that the modulus $q$ has $\poly(n)$-bounded prime factors. Perhaps the new decision problem is best understood for a prime modulus $q$. So let us assume, for now, that $q$ is a $\poly(n)$-bounded prime. 

Define the distribution $\tilde{B}_{\bm{s}, r}$ on the unit sphere $\mathcal{S(X)}$ by choosing $\bm{x} \in \Z_q^n$ and $t \in \Z_q {\setminus} \{ 0 \}$ uniformly at random and outputting the state
\begin{equation}
    \label{equ:new-dec}
    \ket{\tilde{\phi}_{\bm{s}, r}(\bm{x})} = \frac{1}{\sqrt{r}} \sum_{j = 0}^{r - 1} \omega_q^{jt} \ket{j}\ket{\bm{x} + j\bm{s}}.
\end{equation}
The new decision problem is to distinguish between the distributions $B_{\bm{s}, r}$ and $\tilde{B}_{\bm{s}, r}$. The motivation behind this new definition is that the state \eqref{equ:new-dec} can be efficiently transformed to a \textit{shifted} LWE sample $(\bm{a}, \lrang{\bm{a}, \bm{s}} + e + t)$ where $e$ is sampled from $\mathcal{D}_{\Z, q / r}$. For a large enough $q$, this pair is closer to a uniformly random element of $\Z_q^n \times \Z_q$ than an LWE sample. An instance of the above decision problem then translates to an instance of the LWE decision problem. The transformation of \eqref{equ:new-dec} into a shifted LWE sample can be done using the technique in \cite{brakerski2018learning}: given the state $\ket{\tilde{\phi}_{\bm{s}, r}(\bm{x})}$, we first apply the transformation $\ket{j} \mapsto \ket{j - \lfloor (r - 1) / 2 \rfloor}$ to the first register to obtain the state
\begin{equation}
    \label{equ:symm-edcp}
    \frac{1}{\sqrt{r}} \sum_{j = -\lfloor (r - 1) / 2 \rfloor}^{\lceil (r - 1) / 2 \rceil} \omega_q^{jt} \ket{j}\ket{\bm{x} + j\bm{s}},
\end{equation}
where we have again denoted the random element $\bm{x} + \lfloor (r - 1) / 2 \rfloor \bm{s} \in \Z_q^n$ by $\bm{x}$. Next, using the quantum rejection sampling we can, with probability $\Omega(\sigma / r) = \Omega(1 / \sqrt{\kappa})$, transform \eqref{equ:symm-edcp} into 
\begin{equation}
    \label{equ:symm-eg}
    \sum_{j = -\lfloor (r - 1) / 2 \rfloor}^{\lceil (r - 1) / 2 \rceil} \omega_q^{jt} g_\sigma(j) \ket{j}\ket{\bm{x} + j\bm{s}},
\end{equation}
where $g_\sigma(x) = \exp(-\pi x^2 / \sigma^2)$ is the Gaussian distribution. Now if we apply the transform $\qft_q \otimes \qft_{q^n}$ to \eqref{equ:symm-eg} and measure the last register we obtain the state
\[ \ket{\psi} =  \frac{1}{\sqrt{q}} \sum_{y \in \Z_q} \sum_{j = -\lfloor (r - 1) / 2 \rfloor}^{\lceil (r - 1) / 2 \rceil} \omega_q^{j(\lrang{\bm{a}, \bm{s}} + y + t)} g_\sigma(j) \ket{y},\]
where $\bm{a} \in \Z_q^n$ is uniformly random and known. We have
\begin{align*}
    \ket{\psi}
    & \approx_\epsilon \sum_{y \in \Z_q} \sum_{j \in \Z} \omega_q^{j(\lrang{\bm{a}, \bm{s}} + y + t)} g_\sigma(j) \ket{y} \tag{by Lemma ??} \\
    & = \sum_{y \in \Z_q} \sum_{j \in \Z} g_{1/\sigma} \Big( j + \frac{\lrang{\bm{a}, \bm{s}} + y + t}{q} \Big) \ket{y} \tag{by Lemma ??} \\
    & = \sum_{e \in \Z} g_{1/\sigma} \Big( \frac{e}{q} \Big) \ket{\lrang{-\bm{a}, \bm{s}} + e - t \bmod q} \tag{$e = jq + \lrang{\bm{a}, \bm{s}} + t + y$} \\
    & \approx_\epsilon \sum_{e \in \Z_q} g_{1/\sigma} \Big( \frac{e}{q} \Big) \ket{\lrang{-\bm{a}, \bm{s}} + e - t} \tag{by Lemma ??}.
\end{align*}
Measuring the above state, we obtain a pair $(-\bm{a}, \lrang{-\bm{a}, \bm{s}} + e - t)$ where $e$ is sampled from $\mathcal{D}_{\Z, q / \sigma}$. For a general modulus $q$, an immediate generalization of the decision problem would be to just replace the prime modulus with a general one, and the above transformation to an LWE sample goes through without any change. However, for such a generalization, it is not clear how to reduce the search problem to the decision problem when $q$ is super-polynomially large in $n$.
\begin{definition}[EDCP, Decision]
    Let $p \mid q$ be a prime. Define the distribution $B_{\bm{s}, r, p}$ on the unit sphere $\mathcal{S(X)}$ by choosing $\bm{x} \in \Z_q^n$ and $t \in \Z_p {\setminus} \{ 0 \}$ uniformly at random and outputting the state
    \begin{equation}
        \ket{
            \phi_{\bm{s}, r, p}(\bm{x})} = \frac{1}{\sqrt{r}} \sum_{j = 0}^{r - 1} \omega_p^{jt} \ket{j}\ket{\bm{x} + j\bm{s}}.
    \end{equation}
    The decision-$\edcp_{n, q, r}$ is the problem of distinguishing between the distribution $B_{\bm{s}, r}$ and any distribution in the set $\{ B_{\bm{s}, r, p} \}_{p \mid q}$.
\end{definition}
\begin{theorem}
    Assume that all the prime factors of $q$ are $\poly(n)$-bounded. Then there is a polynomial-time quantum reduction from solving search-$\edcp_{n, q, r}$ to solving decision-$\edcp_{n, q, r}$.
\end{theorem}
\begin{proof}
    Let $q = p_1^{e_1} \cdots p_\ell^{e_\ell}$ be the prime factorization of $q$. Let $D$ be an oracle for solving decision-$\edcp_{n, q, r}$. The idea is to use $D$ to find $\bm{s} \bmod p_i^{e_i}$ for all $i$ and then reconstruct $\bm{s} \bmod q$ using the Chinese remainder theorem. Let $\bm{s} = (s_1, \dots, s_n)$. We show how to recover $s_1 \bmod p_1^{e_1}$, the other values $s_i \bmod p_j^{e_j}$ can be computed similarly. Set $p = p_1$ and $e = e_1$.
    For any $y \in \Z_p$ and nonzero $c \in \Z_p$ define the following unitary on $\mathcal{X}$
    \[ U_{c, y} \ket{j}\ket{\bm{a}} = \omega_p^{(a_1 - jy)c}\ket{j}\ket{\bm{a}}, \]
    where $a_1$ is the first coordinate of $\bm{a}$. Given a sample $\rho_{\bm{s}, r}$ from $B_{\bm{s}, r}$, fix $y \in \Z_p$ and select a fresh nonzero $c \in \Z_p$ uniformly at random. Then we have
    \[ U_{c, y}\ket{\phi_{\bm{s}, r}(\bm{x})} = \frac{1}{\sqrt{r}} \omega_p^{x_1}\sum_{j = 0}^{r - 1} \omega_p^{j(s_1 - y)c} \ket{j}\ket{\bm{x} + j\bm{s}}. \]
    Therefore, ignoring the global phase, if $s_1 \ne y \bmod p$ then $U_{c, y} \rho_{\bm{s}, r} U_{c, y}^*$ is a sample from $B_{\bm{s}, r, p}$, otherwise $U_{c, y} \rho_{\bm{s}, r} U_{c, y}^* = \rho_{\bm{s}, r}$. So, the oracle $D$ could tell us which is the case. Trying all $y \in \Z_p$ we can find $s_1 \bmod p$. Now assume we have recovered $\tilde{s}_1 = s_1 \bmod p^k$ for $k < e$. To compute $s_1 \bmod p^{k + 1}$, we can modify the unitary $U_{c, y}$ as 
    \[ U_{c, y, k} \ket{j}\ket{\bm{a}} = \omega_{p^{k + 1}}^{(a_1 - j\tilde{s}_1 - jp^ky)c}\ket{j}\ket{\bm{a}}. \]
    To see how $U_{c, y, k}$ acts on a sample $\rho_{\bm{s}, r}$ from $B_{\bm{s}, r}$, let $s_{1, k + 1}$ be the $(k + 1)$-th digit of $s_1$ in base $p$. Then
    \begin{align*}
        U_{c, y, k} \ket{j}\ket{\bm{x} + j\bm{s}}
        & = \omega_{p^{k + 1}}^{(x_1 + js_1 - j\tilde{s}_1 - jp^ky)c}\ket{j}\ket{\bm{x} + j\bm{s}} \\
        & = \omega_{p^{k + 1}}^{x_1} \omega_p^{j(s_{1, k + 1} - y)c}\ket{j}\ket{\bm{x} + j\bm{s}}.
    \end{align*}
    Therefore, repeating the above procedure, we can recover $s_{1, k + 1}$. This completes the proof.
\end{proof}



%% ///////////////////////////////////////////////////////



\section{Quantum Public-Key Cryptosystem}

A quantum public-key cryptosystem is, similar to a classical system, a set of three algorithms:
\begin{itemize}[itemsep = 1pt]
\item $\gen(1^n)$ generates a public-key $pk$ and a secret-key $sk$, based on the security parameter $n$.
\item $\enc(pk, m)$, outputs a ciphertext $c$ for a given public-key $pk$ and message $m$.
\item $\dec(sk, c)$, outputs a message $m$ for a given secret-key $sk$ and ciphertext $c$.
\end{itemize}
The output pair $(pk, sk)$ of the $\gen$ algorithm for a quantum system is a consists usually of a quantum state and a classical state, respectively. In particular, the public-key $pk$ is a quantum state that is generated using a classical key $sk$. The algorithm $\enc$ encrypts the message $m$, which is classical information, using the quantum state $pk$. The output $c$ of $\enc$ is a quantum state. The algorithm $\dec$ uses the key $sk$ to decrypt the quantum state into a classical message $m$.

For the security parameter $n$, we set the parameters for public key system as follows. We choose $q = \poly(n)$ such that $q = 2^s$ for some integer $s > 0$. We also set $r = 2^{s'}$ where $s' < s$. The main reason for these choices of parameters is efficiency, as we shall explain at the end of this section. In what follows we describe our cryptosystem for encrypting a one-bit message $b \in \{ 0, 1 \}$.

\vspace*{\topskip}

$\gen(1^n)$: Select $\bm{x}, \bm{s} \in \Z_q^n$ uniformly at random. Apply the transformation $\qft_r \otimes \mathds{1}$ to the register $\ket{0} \ket{\bm{x}}$ to obtain the state $\ket{\psi_1} = \frac{1}{\sqrt{r}} \sum_{j = 0}^{r - 1} \ket{j} \ket{\bm{x}}$. Apply the transformation $\ket{j}\ket{\bm{x}} \mapsto \ket{j}\ket{\bm{x} + j\bm{s}}$ to $\ket{\psi_1}$ to obtain the state
\[ \ket{\phi_{\bm{s}, r, 0}(\bm{x})} = \frac{1}{\sqrt{r}} \sum_{j = 0}^{r - 1} \ket{j} \ket{\bm{x} + j\bm{s}}. \]
Return the public-key, secret-key pair $(pk, sk) = (\ket{\phi_{\bm{s}, r, 0}(\bm{x})}, \bm{s})$.     

\begin{figure}[h]
    \centering
    \begin{quantikz}[thin lines]
        \lstick{$\ket{0}$} & \gate{\qft_r} & \ctrl{1} & \qw \\
        \lstick{$\ket{\bm{x}}$} & \qw  & \gate{A} & \qw 
    \end{quantikz}
    \caption{The key generation circuit. The gate $\qft_r$ is the quantum fourier transform over $\Z_r$, and the gate $A$ is the multiply-add operation $\ket{j}\ket{\bm{x}} \mapsto \ket{j}\ket{\bm{x} + j\bm{s}}$.}
\end{figure}

\vspace*{\topskip}

$\enc(pk = \rho_{\bm{s}, r, 0}, b \in \{ 0, 1 \})$:  Apply the transformation $U: \ket{j}\ket{\bm{y}} \mapsto (-1)^{bj}\ket{j}\ket{\bm{y}}$ to $\rho_{\bm{s}, r, 0}$ to obtain the state
\begin{align*}
    U \rho_{\bm{s}, r, 0} U^*
    & = U \E_{\bm{x} \leftarrow \Z_q^n} \Big[ \ket{\phi_{\bm{s}, r, 0}(\bm{x})} \bra{\phi_{\bm{s}, r, 0}(\bm{x})} \Big] U^* \\
    & = \E_{\bm{x} \leftarrow \Z_q^n} \Big[ U \ket{\phi_{\bm{s}, r, 0}(\bm{x})} \bra{\phi_{\bm{s}, r, 0}(\bm{x})} U^* \Big] \\
    & = \E_{\bm{x} \leftarrow \Z_q^n} \Big[ \ket{\phi_{\bm{s}, r, b}(\bm{x})} \bra{\phi_{\bm{s}, r, b}(\bm{x})} \Big] \\
    & = \rho_{\bm{s}, r, b}.
\end{align*}
Return $\rho_{\bm{s}, r, b}$.

\begin{figure}[h]
    \centering
    \begin{quantikz}[thin lines]
         & & \lstick{$\ket{j}$} & \ctrl{2} & \qw & \qw \\
         & & \lstick{$\ket{\bm{y}}$} & \qw & \qw & \qw \\
        \lstick{$\ket{0}$} & \gate{X} & \gate{H} & \gate{U_b} & \meter{} & \qw
    \end{quantikz}
    \caption{The encryption circuit. The gate $U_b$ performs the operation $\ket{j}\ket{c} \mapsto \ket{j}\ket{c \oplus (jb \bmod 2)}$.}
\end{figure}

\vspace*{\topskip}

$\dec(sk = \bm{s}, c = \rho_{\bm{s}, r, b})$:  Apply the transformation $S: \ket{j}\ket{\bm{y}} \mapsto \ket{j}\ket{\bm{y} - j\bm{s}}$ to $\rho_{\bm{s}, r, b}$. Discard the second register. Apply $\qft_r$ to the resulting state and measure. If the measurement result is 0 then output 0, otherwise output 1.

\begin{figure}[h]
    \centering
    \begin{quantikz}[thin lines]
        \lstick{$\ket{j}$} & \ctrl{1} & \gate{\qft_r} & \meter{} & \qw \\
        \lstick{$\ket{\bm{y}}$} & \gate{S} & \meter{} & \qw & \qw
    \end{quantikz}
    \caption{The decryption circuit. The gate $\qft_r$ is the quantum fourier transform over $\Z_r$, and the gate $S$ is the multiply-subtract operation $\ket{j}\ket{\bm{x}} \mapsto \ket{j}\ket{\bm{x} - j\bm{s}}$.}
\end{figure}

\begin{lemma}[Correctness]
    For any bit $b \in \{ 0, 1 \}$ and all outputs $(\bm{s}, \rho_{\bm{s}, r, 0})$ of $\gen$, we have
    \[ \Pr [ \dec(\bm{s}, \enc(\rho_{\bm{s}, r, 0}, b)) = b ] = 1. \]
\end{lemma}
\begin{proof}
    Given a ciphertext $\rho_{\bm{s}, r, b}$, the decryption steps are as follows
    \begin{align*}
        \rho_{\bm{s}, r, b}
        & \mapsto \E_{\bm{x} \leftarrow \Z_q^n} \Big[ A \ket{\phi_{\bm{s}, r, b}(\bm{x})} \bra{\phi_{\bm{s}, r, b}(\bm{x})} A^* \Big]  \tag{apply $A$} \\
        & = \E_{\bm{x} \leftarrow \Z_q^n} \bigg[ \frac{1}{r} \sum_{j = 0}^{r - 1} \sum_{k = 0}^{r - 1} (-1)^{b(j - k)}\ket{k}\ket{\bm{x}} \bra{j}\bra{\bm{x}} \bigg] \\
        & = \frac{1}{r} \sum_{j = 0}^{r - 1} \sum_{k = 0}^{r - 1} (-1)^{b(j - k)}\ket{k}\bra{j} \otimes \E_{\bm{x} \leftarrow \Z_q^n} \Big[ \ket{\bm{x}}\bra{\bm{x}} \Big] \\
        & \mapsto \frac{1}{r} \sum_{j = 0}^{r - 1} \sum_{k = 0}^{r - 1} (-1)^{b(j - k)}\ket{k}\bra{j} \tag{discard the second register} \\
        & \mapsto \qft_r \frac{1}{r} \sum_{j = 0}^{r - 1} \sum_{k = 0}^{r - 1} (-1)^{b(j - k)}\ket{k}\bra{j} \qft_r^* \tag{apply quantum Fourier transform}\\
        & = \ket{br/2} \bra{br/2}
    \end{align*}
    If $b = 0$ then the state of the system is $\ket{0} \bra{0}$, otherwise it is $\ket{r / 2} \bra{r / 2}$. 
\end{proof}


\bibliographystyle{plain}
\bibliography{references}
\end{document}



